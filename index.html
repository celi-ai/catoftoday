<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat of Today</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>
    <style>
        body {
            color: var(--tg-theme-text-color);
            background-color: var(--tg-theme-bg-color);
        }
        #catContainer {
            width: 300px;
            height: 300px;
            background-size: cover;
            position: relative;
            cursor: pointer;
        }
        #patEffect {
            position: absolute;
            font-size: 24px;
            opacity: 0;
            transition: all 0.5s;
        }
    </style>
</head>
<body>
    <h1>Cat of Today</h1>
    
    <div id="patCount">Global Pat Count: 0</div>
    
    <div id="dateDisplay"></div>
    
    <div id="catContainer">
        <div id="patEffect">❤️</div>
    </div>

    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCAZJHR6oxJnefsiLGbutLK10NK4JGLiko",
            authDomain: "catoftoday-e2451.firebaseapp.com",
            projectId: "catoftoday-e2451",
            storageBucket: "catoftoday-e2451.appspot.com",
            messagingSenderId: "246259753230",
            appId: "1:246259753230:web:abc91475e03e9f13cf775f",
            measurementId: "G-53VSVBFRK1"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
        const database = firebase.database();

        const dateDisplay = document.getElementById('dateDisplay');
        const patEffect = document.getElementById('patEffect');
        const patCountDisplay = document.getElementById('patCount');
        const catContainer = document.getElementById('catContainer');

        // Reference to patCount in Firebase
        const patCountRef = database.ref('patCount');

        // Update pat count display
        patCountRef.on('value', (snapshot) => {
            const count = snapshot.val() || 0;
            patCountDisplay.textContent = `Global Pat Count: ${count}`;
        }, (error) => {
            console.error("Error fetching pat count:", error);
        });

        // Function to increment pat count
        function incrementPatCount() {
            patCountRef.transaction((currentCount) => {
                return (currentCount || 0) + 1;
            }).then(() => {
                console.log("Pat count incremented successfully");
            }).catch((error) => {
                console.error("Error incrementing pat count:", error);
            });
        }

        // Display current date
        function updateDateDisplay() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateDisplay.textContent = now.toLocaleDateString('en-US', options);
        }

        // Fetch and display cat image
        function fetchCatImage() {
            fetch('https://api.thecatapi.com/v1/images/search')
                .then(response => response.json())
                .then(data => {
                    catContainer.style.backgroundImage = `url(${data[0].url})`;
                });
        }

        // Pat effect
        function showPatEffect(event) {
            patEffect.style.left = `${event.offsetX}px`;
            patEffect.style.top = `${event.offsetY}px`;
            patEffect.style.opacity = 1;
            setTimeout(() => {
                patEffect.style.opacity = 0;
            }, 500);
        }

        // Event listeners
        catContainer.addEventListener('click', (event) => {
            incrementPatCount();
            showPatEffect(event);
        });

        // Initial setup
        updateDateDisplay();
        fetchCatImage();
        setInterval(fetchCatImage, 24 * 60 * 60 * 1000); // Fetch new cat every 24 hours
    </script>
</body>
</html>